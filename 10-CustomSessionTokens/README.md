# 自定义会话令牌示例扩展
============================

###### 演示如何处理 Burp Suite 通常无法识别的自定义会话令牌

---

## 扩展功能说明

本示例展示了如何将记录的宏与扩展程序结合使用，以自动获取网站的会话令牌，并在 Burp Suite 后续的请求中使用该令牌。

Burp Suite 提供的宏机制允许您记录通过代理触发的会话创建请求。本扩展在此基础上，实现了自动提取和使用会话令牌的功能。

### 主要特性

- 注册 `SessionHandlingAction` 处理器
- 获取宏请求和响应的列表
- 从列表中的最后一个 `HttpRequestResponse` 项提取响应头
- 查找相关的会话头（在本示例中，该头为 `X-Custom-Session-Id`）
- 返回带有更新会话头的 `HttpRequest`

### 技术实现

1. 会话处理：
   - 自动检测和提取会话令牌
   - 支持自定义会话头的处理
   - 自动更新请求中的会话信息

2. 宏集成：
   - 支持从记录的宏中提取会话信息
   - 自动处理宏请求和响应
   - 智能选择最新的会话令牌

3. 请求更新：
   - 自动更新请求头
   - 保持请求的其他部分不变
   - 支持会话令牌的动态替换

### 使用场景

- 处理自定义的会话管理机制
- 自动化会话令牌的获取和更新
- 支持复杂的认证流程
- 提高测试效率

### 注意事项

- 需要正确配置宏记录
- 确保会话头的名称正确
- 注意会话令牌的有效期
- 建议在测试环境中充分验证

### 扩展配置

1. 安装扩展：
   - 将编译后的 JAR 文件加载到 Burp Suite
   - 确保扩展已正确启用

2. 使用方式：
   - 记录获取会话令牌的宏
   - 配置会话处理规则
   - 在需要时自动应用会话令牌

3. 调试建议：
   - 使用 Burp Suite 的日志功能
   - 检查会话令牌的提取和更新
   - 验证请求头的正确性

### 开发说明

1. 扩展结构：
   - `CustomSessionTokens`：扩展入口类
   - `MySessionHandlingAction`：会话处理动作实现类

2. 关键接口：
   - `SessionHandlingAction`：会话处理动作接口
   - `SessionHandlingActionData`：会话处理动作数据接口
   - `ActionResult`：动作结果接口

3. 开发建议：
   - 遵循 Burp Suite 的扩展开发规范
   - 合理处理异常情况
   - 优化会话处理性能
   - 提供清晰的错误信息